<!DOCTYPE html>
<html>

<head>
    <title>List</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous">
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
    </script>
    <link rel="stylesheet" href="/css/toolistyle.css">

    <script>
        $(document).ready(function () {
            var newEntryName, deleteEntryID;

            $(".newEntrySub").click(function () {
                newEntryName = $(".newEnrtyName").val();

                $.post("list/" + window.location.pathname.substring(window
                        .location.pathname.lastIndexOf('/') + 1), {
                        name: newEntryName
                    },
                    function (data) {
                        document.location.reload(true);

                    }
                );
            });
        });
    </script>
</head>

<body>
    <div class="theader">
        <div class="tnavbar">
            <nav>
                <a class="a" href="">Tooli</a>
            </nav>
        </div>
    </div>
    <a class="toolilogolink" href="#">
        <img src="/testbild.png" alt="Logo" class="toolilogo">
    </a>
    <div class="twrapper">
        <div class="tside">
            <div class="tsidebar">
                <div class="tsidetop">
                    <div class="tsidetopcontent">
                        <a href="/new-list" style="position: fixed"> New List</a>
                    </div>
                </div>
                <ul id="lists">
                    <% resList.forEach(function(list){ %>
                    <li id="listsItem">
                        <a href="/list/<%= list.PI %>"><%= list.name %></a>
                        <form method="POST" action="/deleteList">
                            <input type="hidden" name="deleteListId" value="<%=list.PI%>" />
                            <input type="submit" value="X"></input>
                        </form>
                    </li>
                    <% }) %>
                </ul>
            </div>
        </div>
        <div class="row d-flex justify-content-center tcontent">
            <div class="col-md-6">
                <h1>List</h1>
                <div id="entries">
                    <% resEntry.forEach(function(entry){ %>
                    <div id="entryItem" class="entryitem">
                        <input id="entryCheck<%=entry.PI%>" class="entryCheck" value="<%=entry.PI%>" type="checkbox"
                            <% if (entry.Status>0) { %> checked <% } %>></input>
                        <span><%= entry.Name %></span>
                        <form method="POST" action="/deleteEntry">
                            <input type="hidden" name="deleteEntryId" value="<%=entry.PI%>" />
                            <input type="submit" value="X"></input>
                        </form>
                    </div>
                    <% }) %>
                </div>
                <form action="" method="post">
                    <input type="text" name="newEntryName" id="newEntryName" placeholder="Neuer Eintrag" />
                    <input type="submit" id="newEntrySub" value="ok">
                </form>
            </div>
        </div>
    </div>
    <div class="chatarea">
        <ul class="chatitems">
            <% resChat.forEach(function(chatmsg){ %>
            <li class="chatitem">
                <%=chatmsg.sender%> &#58; <%=chatmsg.message%>
            </li>
            <% }) %>
        </ul>
        <form action="" class="chatform" method="POST">
            <button class="chatbutton">Send</button>
            <div class="chatinputbox">
                <input id="chatmessage" class="chatinputtext" autocomplete="off" />
            </div>
        </form>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        $(document).ready(function () {
            var socket = io();
            $('.entryCheck').change(function (e) {
                //e.preventDefault(); // prevents page reloading
                var status = 0;
                if (this.checked)
                    status = 1;
                socket.emit('checkEntryChange', {
                    id: e.target.getAttribute("value"),
                    st: status
                });
                return false;
            });
            socket.on('checkEntryChange', function (msg) {
                var checked = true;
                if (msg.st == 0)
                    checked = false;
                $('#entryCheck' + msg.id).prop('checked', checked);
            });
        });
    </script>

</body>

</html>